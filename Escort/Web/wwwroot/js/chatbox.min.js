function sendCredit(n,t,i){$.ajax({type:"GET",url:"/chatauth/sendgift",data:{giftindex:n,escortId:t},success:function(t){if(t.data>0){sendMessage(i,!1);const r=parseInt($("#creditBalance").text()||0);let t=parseInt(n);n==0&&(t=1);$("#creditBalance").text(r-t)}else toastr.error("Don't have sufficient credits.")}})}function getEscortCredit(){$.ajax({type:"GET",url:"/streaming/GetEscortScore",dataType:"json",success:function(n){n.score>0&&$("#creditBalance").text(n.score)}})}function SendTrigger(){var n=$.Event("keydown",{key:"Enter",keyCode:13,which:13});$("#chatInput").trigger(n)}function handleStickerSend(n){console.log("Sticker sent:",n)}function handleAvatarClick(n){currentAvatar=n.name;console.log("Selected avatar:",n)}const renderMessage=n=>{let t="";switch(n.type){case"ERROR":t=`<div class='error-line'><p>${n.message}</p></div>`;break;case"SUCCESS":t=`<div class='success-line'><p>${n.message}</p></div>`;break;case"STICKER":t=`<div class='chat-line chat-line--sticker'><img class='chat-line-img' src='${n.avatar}' alt='Avatar for ${n.username}' /><p><span class='username'>${n.username}</span></p><img class='chat-sticker' src='${n.sticker}' alt='sticker' /></div>`;break;case"MESSAGE":t=` <div class="chatLeftBlog"><div class='chatProfilePic'><span>${n.username[0]}</span></div><div class='chatUserName'> <h6>${n.username}</h6><p>${n.message}</p></div></div>`}$(".chatBlog").append(t);$(".chatBlog").animate({scrollTop:$(".chatBlog").prop("scrollHeight")},500)};$(document).ready(function(){$($(".escortsBlog1")).each(function(n,t){const i=$(t).find(".escortImg1");$(i).data("src")!=""&&common.getFile(`user/thumbnail_profile/${$(i).data("src")}`,$(i))});handleSignIn(username,moderator,avatarUrl);$("#chatInput").on("keydown",function(n){n.key==="Enter"&&$(this).val()&&(sendMessage($(this).val()),$(this).val(""))});$("#stickerPickerBtn").on("click",function(){});$("#raiseHandBtn").on("click",function(){handleRaiseHandSend()})});let avatarUrl={src:"https://d39ii5l128t5ul.cloudfront.net/assets/chat/v1/sticker-1.png",name:"heart"},username=currentuser,moderator=!1,chatRoom=null,flag=0,handRaised=!1,chatConfig={CHAT_REGION:"us-east-1",Chat_Room_Id:roomId};const uuidv4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),tokenProvider=async(n,t,i)=>{const r=uuidv4(),u=t?["SEND_MESSAGE","DELETE_MESSAGE","DISCONNECT_USER"]:["SEND_MESSAGE"],f={roomidentifier:chatConfig.Chat_Room_Id,userId:`${n}.${r}`,attributes:{username:`${n}`,avatar:`${i.src}`},capabilities:u};try{const n=await $.post(`/chatauth/getchattoken`,f);return{token:n.token,sessionExpirationTime:new Date(n.sessionExpirationTime),tokenExpirationTime:new Date(n.tokenExpirationTime)}}catch(e){flag==0&&(swal({title:"This live stream has ended",text:"Explore our other content in the meantime!",type:"error",showCancelButton:!1,confirmButtonColor:"#EC881D",confirmButtonText:"Go to Home"}).then(function(){window.location.href="/home/index"}),flag++);console.error("Error:",e)}},handleSignIn=async(n,t,i)=>{username=n,moderator=t,chatRoom=new MakeRoom({regionOrUrl:chatConfig.CHAT_REGION,tokenProvider:()=>tokenProvider(n,t,i)}),chatRoom.connect(),chatRoom.addListener("connect",()=>{renderMessage({type:"SUCCESS",message:"Connected..."})}),chatRoom.addListener("disconnect",n=>{renderMessage({type:"ERROR",message:`Connection closed. Reason: ${n}`})}),chatRoom.addListener("message",n=>{handleMessage(n)}),$("#signInModal").hide()},giftsend=(n,t,i,r)=>{const u=$(n).data("popup"),f=`just sent a <img src='/assets/images/gifts/${r.toLowerCase().replace("n","")}.png' width='20px' title='${u}' alt='${u}'>`;sendCredit(t,i,f)},handleMessage=n=>{const t={type:n.attributes?.message_type||"MESSAGE",timestamp:n.sendTime,username:n.sender.attributes.username,userId:n.sender.userId,avatar:n.sender.attributes.avatar,message:n.content,messageId:n.id};typeof escortId=="undefined"&&getEscortCredit();t.type==="RAISE_HAND"?handleRaiseHand(t):t.type==="STICKER"?handleSticker(t):renderMessage(t)},sendMessage=async(n,t=true)=>{const i=`${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}`,r=new SendMessageRequestLocal(i);try{let n=await chatRoom.sendMessage(r);typeof escortId!="undefined"&&t}catch(u){renderMessage({type:"ERROR",message:`Error sending message: ${u.message}`})}},handleRaiseHandSend=async()=>{const n=new SendMessageRequestLocal(`[raise hand event]`,{message_type:"RAISE_HAND"});try{await chatRoom.sendMessage(n);handRaised=!handRaised}catch(t){renderMessage({type:"ERROR",message:`Error raising hand: ${t.message}`})}},handleRaiseHand=()=>{},handleSticker=()=>{};let $stickerButton=$(".input-line-btn"),$stickersContainer=$(".stickers-container");$stickerButton.on("click",function(){$stickersContainer.toggleClass("hidden")});const STICKERS=[{name:"smile",src:"https://d39ii5l128t5ul.cloudfront.net/assets/chat/v1/sticker-1.png"},{name:"heart",src:"https://d39ii5l128t5ul.cloudfront.net/assets/chat/v1/sticker-1.png"},];STICKERS.forEach(n=>{const t=$(`
    <button class="sticker-btn" aria-label="${n.name}">
        <img class="sticker-item" src="${n.src}" alt="${n.name} sticker">
    </button>
    `);t.on("click",function(){$stickersContainer.addClass("hidden");handleStickerSend(n)});$stickersContainer.append(t)});const AVATARS=[{name:"avatar1",src:"path/to/avatar1.png"},{name:"avatar2",src:"path/to/avatar2.png"},];let currentAvatar=null;