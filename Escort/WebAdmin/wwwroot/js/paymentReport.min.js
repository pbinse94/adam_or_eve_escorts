function updateSelectAllState(){let n=paymenttable.find(".payment-checkbox"),t=n.filter(":checked"),i=n.length>0&&n.length===t.length;$("#selectAll").prop("disabled",n.length===0).prop("checked",i)}function LoadTable(){if(toastr.remove(),$("#txtFromDate").val()==""&&$("#txtToDate").val()=="")return toastr.error('"Please provide either a From Date or a To Date."'),!1;const n=new Date($("#txtFromDate").val()),t=new Date($("#txtToDate").val());if(n>t)return toastr.error("From date can not be greater than to date."),!1;payment.List()}function Reset(){$("#txtFromDate").val("");$("#txtToDate").val("");payment.List()}function MarkPaymentDone(){if(toastr.remove(),$("#hiddenFieldId").val()=="")return toastr.error("Please select users for payment done"),!1;swal({title:"Are you sure?",text:"Do you want to mark payment done",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(function(n){if(n){EnableDisableButton($("#markPayment"),!0);let n=$("#hiddenFieldId").val();$.ajax({url:"/UserTokenTransaction/MarkPaymentDone",type:"POST",data:{userIds:n},success:function(n){n.data>0?toastr.success(n.message):toastr.error(n.message);setTimeout(function(){payment.List()},1e3);EnableDisableButton($("#markPayment"),!1)},error:function(){EnableDisableButton($("#markPayment"),!1);toastr.error(data.responseJSON?.message)}})}})}$(function(){$.when(payment.ResetStateSaveDataTable()).then(function(){payment.List()})});let paymenttable=$("#data-table_paymentReport"),payment={ResetStateSaveDataTable:function(){common.isReferrer()&&paymenttable.DataTable().state.clear()},List:function(){let n=[];$(paymenttable).find("thead tr th").each(function(t,i){let r=$(i).data("name"),u;switch(r.toLowerCase()){case"id":u={data:null,name:r,render:function(n,t,i,r){return r.row+r.settings._iDisplayStart+1}};break;case"escortname":u={data:null,name:r,"class":"fw-semibold",mRender:function(n){return`<a href="/UserTokenTransaction/EscortPaymentReport?escortId=`+n.escortId+"&isPaid=false&adminPercentage=25&escortName="+n.escortName+`"  style="text-decoration: underline;">${n.escortName}</a>`}};break;case"ispaymentdone":u={data:null,name:r,render:function(n){let t=n.isPaymentDone?"disabled":"";return`
                        <input type="hidden" class="user-id-hidden" value="${n.escortId}" />
                         <div class="form-check mt-2">
                        <input type="checkbox" class="payment-checkbox form-check-input" data-id="${n.id}" ${t} ${n.isPaymentDone?"checked":""} />

                        </div>

                    `}};break;case"payment":u={width:"15%","class":"dt-right",data:null,name:r,render:function(n){return"$"+n.payment.toFixed(2).toLocaleString("en")}};break;case"bankccountholdername":u={width:"15%",data:null,name:r,render:function(n){return n}};break;case"bsbnumber":u={data:null,name:r,render:function(n){return n.bsbNumber}};break;default:u={data:r.charAt(0).toLowerCase()+r.slice(1),name:r,width:"15%"}}n.push(u)});let t;t=$("#paidFilter").val()==1?[0,5,6]:[0,1,6,7];let i={FromDate:$("#txtFromDate").val(),ToDate:$("#txtToDate").val(),PaidFilter:$("#paidFilter").val()};tbl.BindTable(paymenttable,`/UserTokenTransaction/PaymentReport`,i,n,t);$("#selectAll").on("change",function(){let n=$(this).is(":checked");paymenttable.find(".payment-checkbox").each(function(){$(this).prop("disabled")||$(this).prop("checked",n)});updateSelectAllState()});setTimeout(function(){updateSelectAllState();payment.SumOfPoints()},1e3)},SumOfPoints:function(){let t=paymenttable.DataTable(),n=0;t.rows().every(function(){n=n+this.data().payment});$("#total_amount").text("$"+Number(n).toFixed(2).toLocaleString("en"))}};$("#txtFromDate").datepicker({weekStart:1,autoclose:!0,todayHighlight:!1,dateFormat:"dd-M-yy",changeMonth:!0,changeYear:!0,maxDate:-1,onSelect:function(n){var t=new Date(n);$("#txtToDate").datepicker("option","minDate",t)}});$("#txtToDate").datepicker({weekStart:1,autoclose:!0,todayHighlight:!1,dateFormat:"dd-M-yy",changeMonth:!0,changeYear:!0,maxDate:-1,onSelect:function(n){var t=new Date(n);$("#txtFromDate").datepicker("option","maxDate",t)}});$(document).ready(function(){updateSelectAllState();$("#selectAll").on("change",function(){let t=$(this).is(":checked"),i=$("#hiddenFieldId"),n=[];paymenttable.find(".payment-checkbox").each(function(){if(!$(this).prop("disabled")){$(this).prop("checked",t);let i=$(this).closest("tr").find(".user-id-hidden").val();t?n.includes(i)||n.push(i):n=n.filter(n=>n!==i)}});i.val(n.join(","))});$(document).on("change",".payment-checkbox",function(){let t=$(this).closest("tr").find(".user-id-hidden").val(),i=$("#hiddenFieldId"),r=i.val(),n=r?r.split(","):[];$(this).is(":checked")?n.includes(t)||n.push(t):n=n.filter(n=>n!==t);i.val(n.join(","));updateSelectAllState()})});